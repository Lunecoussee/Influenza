---
title: "R project: hypothesis 1"
output: html_document
date: "2024-11-21"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

```{r Libraries}
library(tidyverse)
library(ggplot2)
```


```{r}
data = read_csv('fluprint_export.csv')
```
```{r QQPlot_Dummy}
#load or install the ggpubr package
install.packages("ggpubr")
library(ggpubr)
```

```{r}
head(data)
```

```{r}
metadata <- data %>% select(-name, -name_formatted, -subset, -units, -data, -mesurment_id, -assay) %>% distinct() 
```

```{r}
head(metadata)
```

```{r}
class(metadata$vaccine_response)
class(metadata$influenza_infection_history)
```
```{r}
metadata$vaccine_response[metadata$vaccine_response == 'NULL'] <- NA
metadata <- na.omit(metadata)
```

```{r}
metadata$vaccine_response <- as.factor(metadata$vaccine_response)
metadata$influenza_infection_history <- as.factor(metadata$influenza_infection_history)
class(metadata$vaccine_response)
class(metadata$influenza_infection_history)
head(metadata)
```

```{r}
library(dplyr)
library(ggplot2)

metadata <- metadata %>%
  mutate(
    vaccine_response = factor(vaccine_response, 
                              levels = c(0, 1), 
                              labels = c("low responder", "high responder")),
    influenza_infection_history = factor(influenza_infection_history, 
                                         levels = c(0, 1), 
                                         labels = c("never infected", "ever infected"))
  )

# Create the bar plot
metadata %>%
  ggplot(aes(x = vaccine_response, fill = influenza_infection_history)) +
    geom_bar() +
    labs(title = "Stacked Bar Plot: vaccine response vs infection history", x = "vaccine response", fill = "Infection History") +
    theme_classic()
```

```{r}
metadata %>%
  ggplot(aes(x=influenza_infection_history, fill=vaccine_response)) +
    geom_bar() +
    labs(title = "Stacked Bar Plot: Impact of Infection History on Vaccine Response", x = "infection history", fill = "vaccine response") +
    theme_classic()
```

```{r}
ggplot(metadata, aes(x = vaccine_response, fill = influenza_infection_history)) +
  geom_bar(position = "dodge") +
  labs(title = "Grouped Bar Plot: vaccine response vs infection history", x = "vaccine response", fill = "infection history")
```

```{r}
ggplot(metadata, aes(x = influenza_infection_history, fill = vaccine_response)) +
  geom_bar(position = "dodge") +
  labs(title = "Grouped Bar Plot: Impact of Infection History on Vaccine Response", x = "infection history", fill = "vaccine response")
```

```{r}
contingency_table <- table(metadata$vaccine_response, metadata$influenza_infection_history)
print(contingency_table)
```

```{r}
# Convert contingency table to data frame for ggplot
table_df <- as.data.frame(table(metadata$vaccine_response, metadata$influenza_infection_history))
colnames(table_df) <- c("vaccine_response", "infection_history", "Count")
table_df
```

```{r}
# Create heatmap
ggplot(table_df, aes(x = infection_history , y = vaccine_response , fill = Count)) +
  geom_tile() +
  scale_fill_gradient(low = "white", high = "red") +
  labs(title = "Heatmap of infection history vs vaccine response", 
       x = "influenza infection history", 
       y = "vaccine response", 
       fill = "count")
```

```{r}
#fisher-test want lage values verwacht voor de positieve influenza histories. Ook omdat we 2 categorische variabelen vergelijken (niet meer, anders chi kwadraat test).
fisher_test <- fisher.test(contingency_table)
print(fisher_test)
```

```{r}

```

```{r}

```

```{r}

```
